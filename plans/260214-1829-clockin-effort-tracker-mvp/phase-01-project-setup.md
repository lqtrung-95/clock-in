# Phase 01: Project Setup

## Context Links
- [Parent Plan](./plan.md)
- [Frontend Research](./research/researcher-01-frontend-stack.md)
- [PRD](../reports/brainstorm-260214-1829-clockin-effort-tracker-prd.md)

## Overview
- **Priority:** P1 (blocking all other phases)
- **Status:** pending
- **Effort:** 6h
- **Description:** Scaffold Next.js 15 project with all tooling: TypeScript, Tailwind CSS, shadcn/ui, Supabase client, Serwist PWA, Zustand, ESLint, and define the complete project directory structure.

## Key Insights
- Serwist preferred over next-pwa for greenfield Next.js 15 (modern API, better TS support)
- @supabase/ssr is the official package for Next.js App Router integration
- Zustand persist middleware handles localStorage sync out of the box
- Keep files < 200 lines; use kebab-case naming

## Requirements

### Functional
- Next.js 15 App Router with TypeScript strict mode
- Tailwind CSS 4 + shadcn/ui components initialized
- Supabase client configured (browser + server)
- PWA manifest + service worker via Serwist
- Zustand store scaffolded
- Environment variables for Supabase URL/anon key, Resend API key
- ESLint + Prettier configured

### Non-Functional
- App shell loads < 2s on 3G
- TypeScript strict mode enabled
- All imports use path aliases (@/)

## Architecture

### Project File Structure
```
clockin/
├── public/
│   ├── icons/                          # PWA icons (192x192, 512x512)
│   ├── backgrounds/                    # Focus mode WebP images (10-20)
│   ├── sounds/                         # Ambient sound files (opus/mp3)
│   └── manifest.json                   # PWA manifest (generated by Serwist)
├── src/
│   ├── app/
│   │   ├── layout.tsx                  # Root layout (providers, fonts, metadata)
│   │   ├── page.tsx                    # Landing / redirect to dashboard
│   │   ├── globals.css                 # Tailwind imports + CSS variables
│   │   ├── (auth)/
│   │   │   ├── login/
│   │   │   │   └── page.tsx            # Login page
│   │   │   ├── signup/
│   │   │   │   └── page.tsx            # Signup page
│   │   │   └── callback/
│   │   │       └── route.ts            # OAuth callback handler
│   │   ├── (dashboard)/
│   │   │   ├── layout.tsx              # Dashboard shell (sidebar, nav)
│   │   │   ├── page.tsx                # Main dashboard
│   │   │   ├── timer/
│   │   │   │   └── page.tsx            # Timer page
│   │   │   ├── focus/
│   │   │   │   └── page.tsx            # Focus/Pomodoro mode
│   │   │   ├── entries/
│   │   │   │   └── page.tsx            # Time entries list
│   │   │   ├── categories/
│   │   │   │   └── page.tsx            # Category management
│   │   │   ├── analytics/
│   │   │   │   └── page.tsx            # Charts & analytics
│   │   │   ├── goals/
│   │   │   │   └── page.tsx            # Goals & challenges
│   │   │   └── settings/
│   │   │       └── page.tsx            # User preferences
│   │   └── api/
│   │       └── cron/
│   │           └── digest/
│   │               └── route.ts        # Weekly digest trigger (backup)
│   ├── components/
│   │   ├── ui/                         # shadcn/ui components (auto-generated)
│   │   ├── layout/
│   │   │   ├── app-sidebar.tsx         # Main sidebar navigation
│   │   │   ├── top-nav-bar.tsx         # Top nav with user menu
│   │   │   └── mobile-bottom-nav.tsx   # Mobile bottom tab bar
│   │   ├── auth/
│   │   │   ├── login-form.tsx          # Email/password + OAuth buttons
│   │   │   └── signup-form.tsx         # Registration form
│   │   ├── timer/
│   │   │   ├── timer-display.tsx       # Timer clock face
│   │   │   ├── timer-controls.tsx      # Start/stop/pause buttons
│   │   │   └── quick-start-widget.tsx  # Resume last activity
│   │   ├── pomodoro/
│   │   │   ├── pomodoro-timer.tsx      # Pomodoro-specific timer
│   │   │   ├── pomodoro-presets.tsx    # Preset selector (25/5, 50/10, 90/20)
│   │   │   └── cycle-progress.tsx      # Visual cycle indicator
│   │   ├── focus/
│   │   │   ├── focus-mode-overlay.tsx  # Full-screen focus view
│   │   │   ├── background-picker.tsx   # Background image selector
│   │   │   ├── ambient-sound-player.tsx # Sound controls
│   │   │   └── playlist-embed.tsx      # YouTube/Spotify embed
│   │   ├── entries/
│   │   │   ├── entry-list.tsx          # Time entries table/list
│   │   │   ├── entry-form.tsx          # Manual entry form
│   │   │   └── entry-card.tsx          # Single entry display
│   │   ├── categories/
│   │   │   ├── category-list.tsx       # Category grid/list
│   │   │   ├── category-form.tsx       # Create/edit category
│   │   │   └── category-badge.tsx      # Inline category chip
│   │   ├── dashboard/
│   │   │   ├── today-summary-card.tsx  # Today's total hours
│   │   │   ├── weekly-summary-card.tsx # Weekly overview
│   │   │   ├── streak-display.tsx      # Current streak counter
│   │   │   └── motivational-message.tsx # Dynamic message
│   │   ├── analytics/
│   │   │   ├── daily-bar-chart.tsx     # Daily hours chart
│   │   │   ├── weekly-bar-chart.tsx    # Weekly hours chart
│   │   │   └── category-breakdown-chart.tsx # Per-category pie/bar
│   │   ├── gamification/
│   │   │   ├── badge-grid.tsx          # Earned badges display
│   │   │   ├── focus-score-card.tsx    # Focus score widget
│   │   │   ├── goal-progress-card.tsx  # Goal completion ring
│   │   │   └── challenge-card.tsx      # Daily/weekly challenge
│   │   └── shared/
│   │       ├── loading-spinner.tsx     # Generic loading state
│   │       ├── empty-state.tsx         # No data placeholder
│   │       └── confetti-trigger.tsx    # canvas-confetti wrapper
│   ├── lib/
│   │   ├── supabase/
│   │   │   ├── client.ts              # Browser client (createBrowserClient)
│   │   │   ├── server.ts              # Server client (createServerClient)
│   │   │   └── middleware.ts           # Auth middleware helper
│   │   ├── utils.ts                    # cn() + general utilities
│   │   └── constants.ts               # App-wide constants
│   ├── stores/
│   │   ├── timer-store.ts             # Timer state (Zustand + persist)
│   │   ├── pomodoro-store.ts          # Pomodoro state
│   │   ├── category-store.ts          # Categories cache
│   │   └── preferences-store.ts       # User preferences
│   ├── hooks/
│   │   ├── use-timer.ts               # Timer logic hook
│   │   ├── use-pomodoro.ts            # Pomodoro logic hook
│   │   ├── use-audio.ts               # Web Audio API hook
│   │   ├── use-visibility.ts          # Page Visibility API hook
│   │   └── use-supabase.ts            # Supabase client hook
│   ├── types/
│   │   ├── database.ts                # Supabase generated types
│   │   ├── timer.ts                   # Timer-related types
│   │   └── gamification.ts            # Badges, streaks, goals types
│   ├── services/
│   │   ├── time-entry-service.ts      # CRUD for time entries
│   │   ├── category-service.ts        # CRUD for categories
│   │   ├── streak-service.ts          # Streak calculation logic
│   │   ├── goal-service.ts            # Goal progress logic
│   │   └── badge-service.ts           # Badge evaluation logic
│   └── data/
│       ├── preset-categories.ts       # Default category templates
│       ├── badge-definitions.ts       # Badge rules & metadata
│       ├── challenge-definitions.ts   # Challenge templates
│       ├── motivational-messages.ts   # Message pool
│       └── background-images.ts       # Background image metadata
├── supabase/
│   ├── config.toml                    # Supabase local config
│   ├── migrations/
│   │   ├── 00001_create-users-profile.sql
│   │   ├── 00002_create-categories.sql
│   │   ├── 00003_create-time-entries.sql
│   │   ├── 00004_create-pomodoro-sessions.sql
│   │   ├── 00005_create-streaks.sql
│   │   ├── 00006_create-goals.sql
│   │   ├── 00007_create-badges.sql
│   │   ├── 00008_create-challenges.sql
│   │   ├── 00009_create-user-preferences.sql
│   │   └── 00010_create-rls-policies.sql
│   └── functions/
│       └── weekly-digest/
│           └── index.ts               # Edge Function for email digest
├── middleware.ts                       # Next.js middleware (auth)
├── next.config.ts                     # Next.js config + Serwist
├── tailwind.config.ts                 # Tailwind config
├── tsconfig.json
├── package.json
├── .env.local.example                 # Environment template
├── .gitignore
└── README.md
```

## Related Code Files

### Files to Create
- `src/app/layout.tsx` — Root layout with providers
- `src/app/globals.css` — Tailwind base + CSS custom properties
- `src/lib/supabase/client.ts` — Browser Supabase client
- `src/lib/supabase/server.ts` — Server Supabase client
- `src/lib/supabase/middleware.ts` — Auth helper for middleware
- `src/lib/utils.ts` — cn() utility
- `src/lib/constants.ts` — App constants
- `middleware.ts` — Route protection
- `next.config.ts` — With Serwist integration
- `.env.local.example` — Env template

## Implementation Steps

### 1. Scaffold Next.js 15 project
```bash
npx create-next-app@latest clockin --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --turbopack
cd clockin
```

### 2. Install core dependencies
```bash
# UI
npm install @radix-ui/react-slot class-variance-authority clsx tailwind-merge lucide-react

# Supabase
npm install @supabase/supabase-js @supabase/ssr

# State management
npm install zustand

# Charts
npm install recharts

# PWA
npm install @serwist/next
npm install -D serwist

# Celebrations
npm install canvas-confetti
npm install -D @types/canvas-confetti

# Date utilities
npm install date-fns
```

### 3. Initialize shadcn/ui
```bash
npx shadcn@latest init
# Select: New York style, Zinc base color, CSS variables: yes
npx shadcn@latest add button card dialog dropdown-menu input label select sheet tabs toast badge progress separator avatar
```

### 4. Configure Serwist for PWA
In `next.config.ts`:
```typescript
import withSerwistInit from "@serwist/next";

const withSerwist = withSerwistInit({
  swSrc: "src/app/sw.ts",
  swDest: "public/sw.js",
});

export default withSerwist({
  // Next.js config
});
```

Create `src/app/sw.ts`:
```typescript
import { defaultCache } from "@serwist/next/worker";
import type { PrecacheEntry, SerwistGlobalConfig } from "serwist";
import { Serwist } from "serwist";

declare global {
  interface WorkerGlobalScope extends SerwistGlobalConfig {
    __SW_MANIFEST: (PrecacheEntry | string)[] | undefined;
  }
}

declare const self: ServiceWorkerGlobalScope;

const serwist = new Serwist({
  precacheEntries: self.__SW_MANIFEST,
  skipWaiting: true,
  clientsClaim: true,
  navigationPreload: true,
  runtimeCaching: defaultCache,
});

serwist.addEventListeners();
```

### 5. Create environment template
`.env.local.example`:
```
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
RESEND_API_KEY=your-resend-key
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### 6. Set up Supabase clients

`src/lib/supabase/client.ts`:
```typescript
import { createBrowserClient } from "@supabase/ssr";
import type { Database } from "@/types/database";

export function createClient() {
  return createBrowserClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
  );
}
```

`src/lib/supabase/server.ts`:
```typescript
import { createServerClient } from "@supabase/ssr";
import { cookies } from "next/headers";
import type { Database } from "@/types/database";

export async function createClient() {
  const cookieStore = await cookies();
  return createServerClient<Database>(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() { return cookieStore.getAll(); },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value, options }) =>
            cookieStore.set(name, value, options)
          );
        },
      },
    },
  );
}
```

### 7. Create middleware stub
`middleware.ts`:
```typescript
import { type NextRequest, NextResponse } from "next/server";
import { updateSession } from "@/lib/supabase/middleware";

export async function middleware(request: NextRequest) {
  return await updateSession(request);
}

export const config = {
  matcher: [
    "/((?!_next/static|_next/image|favicon.ico|icons|backgrounds|sounds|sw.js|manifest.json).*)",
  ],
};
```

### 8. Create root layout with providers
`src/app/layout.tsx` with metadata, viewport for PWA, theme provider (next-themes), and font loading.

### 9. Set up project structure directories
Create all directories listed in the file structure above (empty initially, populated in later phases).

### 10. Configure dark/light mode
```bash
npm install next-themes
```
Add `ThemeProvider` in root layout. Configure Tailwind for `darkMode: "class"`.

### 11. Add PWA icons and manifest metadata
Create `public/icons/icon-192x192.png` and `icon-512x512.png` (placeholder). Add PWA metadata in `layout.tsx`.

### 12. Verify build
```bash
npm run build
npm run dev
```
Confirm: app loads, no TS errors, PWA manifest served, service worker registered.

## Todo List
- [ ] Scaffold Next.js 15 project
- [ ] Install all dependencies (Supabase, Zustand, Recharts, Serwist, etc.)
- [ ] Initialize shadcn/ui + add required components
- [ ] Configure Serwist PWA
- [ ] Create Supabase client/server helpers
- [ ] Create middleware stub
- [ ] Set up root layout with providers + ThemeProvider
- [ ] Create all directory structure
- [ ] Create .env.local.example
- [ ] Add PWA icons (placeholder)
- [ ] Verify clean build + dev server runs
- [ ] Initialize Supabase CLI (`npx supabase init`)

## Success Criteria
- `npm run build` passes with 0 errors
- Dev server starts and renders landing page
- PWA manifest accessible at /manifest.json
- Service worker registers in browser
- Supabase client initializes without errors
- Dark/light mode toggle works
- All path aliases (@/) resolve correctly

## Risk Assessment
| Risk | Impact | Mitigation |
|------|--------|------------|
| Serwist + Next.js 15 incompatibility | High | Pin Serwist version; check compatibility matrix |
| shadcn/ui breaking changes | Medium | Use latest stable; pin component versions |
| Tailwind v4 config differences | Low | Follow official Tailwind v4 migration guide |

## Security Considerations
- Never commit `.env.local` (add to .gitignore)
- Supabase anon key is public but RLS enforces data access
- Service worker scoped to same origin only

## Next Steps
- Phase 02: Database schema + auth setup
